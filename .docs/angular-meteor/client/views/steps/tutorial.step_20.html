<template name="tutorial.step_20.html">
  <div>
    <a href="https://github.com/Urigo/angular-meteor/edit/master/.docs/angular-meteor/client/views/steps/tutorial.step_20.html"
       class="btn btn-default btn-lg improve-button">
      <i class="glyphicon glyphicon-edit">&nbsp;</i>Improve this doc
    </a>
    <ul class="btn-group tutorial-nav">
      <a href="/tutorial/step_19"><li class="btn btn-primary"><i class="glyphicon glyphicon-step-backward"></i> Previous</li></a>
      <a href="/tutorial/next_steps"><li class="btn btn-primary">Next <i class="glyphicon glyphicon-step-forward"></i></li></a>
    </ul>

    <div class="col-md-8">
      <h1>Step 20 - CollectionFS</h1>
    </div>
    <div class="video-tutorial col-md-4">
    </div>

    <do-nothing class="col-md-12">
  {{#markdown}}

CollectionFS is a suite of Meteor packages that together provide a complete file management solution including uploading, downloading, storage, synchronization, manipulation, and copying. It supports several storage adapters for saving to the local filesystem, GridFS, or S3, and additional storage adapters can be created.
The full documentation for CollectionFS could be found [here](https://github.com/CollectionFS/Meteor-CollectionFS).
CollectionFS is also available for using with Angular-Meteor using the `$meteorCollectionFS` API.

This part of the tutorial will demonstrate usage of CollectionFS and Angular-Meteor using the example of file-uploading.

This part of the tutorial assumes you already have a basic experience with Angular-Meteor, and will use some of the APIs that this package provides.
So assuming you already have an Angular-Meteor project, we will starting by adding CollectionFS to our project by running the following command:
```
meteor add cfs:standard-packages
```

Now, we will decide the the storage adapter we want to use. CollectionFS provides adapters for many popular storage methods, link FileSystem, GridFS, Amazon S3 and DropBox.
In this example, we will use the GridFS as storage adapters, so we will add the adapter adapter by running this command:
```
meteor add cfs:gridfs
```
Node: you can find more information about Stores and Storage Adapters on the CollectionFS's GitHub repository.

So now we have the CollectionFS support and the storage adapter - we need to create a CollectionFS object to handle our files.
Note that you will need to define the collection as shared resource because you will need to use the collection in noth client and server side.

I create the model.js file, and define a regular CollectionFS object called "Images":
```
Images = new FS.Collection("images", {
    stores: [
      new FS.Store.GridFS("original")
    ],
    filter: {
      allow: {
        contentTypes: ['image/*']
      }
    }
});
```

So now we have the collection, we need to create a client-side that handles the images upload.
Note: you can use basic HTML `<input type="file">`  or any other package as you want - you only need the HTML5 File object to be provided.

So now we wil create `example.ng.hmtl` "client" directory with a basic usage of HTML File input inside it:
```
    <div ng-controller="ExampleCtrl">
      <input type="file" id="upload-file">
    </div>
``

No we need to create the main logic in our `example.js`, we will liste to "change" event on the File input and add the image to collection:
 ```
angular.module('example', ['angular-meteor']);

angular.module('example').controller('ExampleCtrl', ['$scope', function ($scope) {
  $('#upload-file').bind("change", function (event) {
    // TODO: Save the image
  });
}]);
```

Great! Now all we have to to is to use $meteorCollectionFS in order to get the CollectionFS we created.
Note that the API of $meteorCollectionFS is the same of $meteorCollection, the only difference is that $meteorCollectionFS works with HTML File object.
```
angular.module('example').controller('ExampleCtrl', function ($meteor, $scope) {
  $scope.images = $scope.$meteorCollectionFS(Images, false, Images);

  $scope.addImages = function (files) {
    $scope.images.save(files);
  };
});
```

And that's it! Now the file is uploaded!
We can easily use ng-repeat or any other code to display our list, and use `url()` method to get the image url, for example:
```
    <table>
      <thead>
      <tr>
        <th>File Name</th>
        <th>Thumbnail</th>
      </tr>
      </thead>
      <tbody>
      <tr ng-repeat="image in images">
        <td>{{image.original.name}}</td>
        <td><img class="thumbnail" ng-src="{ { image.url() } }"></td>
      </tr>
      </tbody>
    </table>
```


You can see the full example in the Angular-Meteor repository, under examples/collectionfs.

  {{/markdown}}
    </do-nothing>

    <div class="col-md-12">
	    <ul class="btn-group tutorial-nav">
		    <a href="/tutorial/step_19"><li class="btn btn-primary"><i class="glyphicon glyphicon-step-backward"></i> Previous</li></a>
		    <a href="/tutorial/next_steps"><li class="btn btn-primary">Next <i class="glyphicon glyphicon-step-forward"></i></li></a>
	    </ul>
    </div>
  </div>
</template>


